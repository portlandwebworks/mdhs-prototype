language: java
jdk:
- oraclejdk8
services:
- docker
cache:
  directories:
  - $HOME/.m2
sudo: false
install: true
env:
  global:
  - CLOUDSDK_CORE_DISABLE_PROMPTS=1
  - secure: nGaSrIHiErZRQaMGPS+QAIGXAsfqwnKcISgBvJ2e1WyiqJLjabuRW2FUq+GxdfYjL0/AhkoVeumde1HHh8EgNUyVK6xSIVYl5XF0ACiZwcotQlg45cl14Z6UJB9UK/bg4dwxOsX8+DeA5zy2aW0NMuZ0xFAY/3CZ1TsAjiXJwSdBaLY/7KXXYadlRj/bfXhGn6tC6wYHPn+B14u5m6p5JnqCVZt+5nmwa8HM6p8Yn/GMwHVzzIElzX0u2pQvqjdP+258lcRx3x6pZFVd+1Zmp3AtbOO2GyIRgSmv35QigXSMuzBkCKX7aLbZ+Ni8yhq/csZypsO13NeUnGxKiyb7gXCOzOD2sF6ehOQhvmRzZ5iKlgNhAerYQ0Xt7htURvmlZiNgzVkgLeAIWyRGoqZMxohXu/VrzfoSzjGBzvu9syEAVYhnYDy2qznPqFhVB5eFc8JGag+eDislnh6dJlZ41lwrWqpZ7A27T2/xVn7hviisjYKFU6aieyRFTijYVflVW1wmfbbUiWviAkLt73Nxvh0kPsgHp1PVDxB8+s+jFcVh6FonudiwTCPIbLV0RPpOQ2ps/CaNPjh4SPqDm3vzlzaPKcb3fPhbE/wRtRZMiA9Cqf94nlnZBlnZm49K1LMQoCxfhc8RoLrhm4ANGJREj+qxXES6QFfYi6wLbejraXY=
  - secure: fa6QHez9je+xJELdLmmGCrg4Kqq13b+O7u8iCAM4bwK7hetHtaF40knk3fdMT7k/XOL3O3Y3OWxsqTanhs08tu8qqEdks/3TdJ5H/TQgMULlTZhg4xQSvCNlalnMakTe1OYu3cMw/P+FzzDdlyINkWDegZpEMFPRjzjtHdKWaxy1twwLP/HeN1W9vAiWJ90shUSdp8eEZ4vEEtp3Teqau0tz5bS8OIk9NXfB/tX/1hJtqpBd/msZ64cS2Sqo/UlmyQlBXDXBBpMG6azkliSbabZgwLXLbblsLF3AuaFdGNvCnbx1IC37X0w3oxwFqY6UHJYpYhhz1zaFpNpQnlpG5tywYfAHrgKnqj741vvfsO3ogRgxwnMXMsTheBWfEhD23JalEtCoroIgdbkvphJ1zSomwG6L1JRW27hUVRXnaUPEDUtrEIPgHNehl/b3zt4rI2e6lubmxIxFt8j9KnvCeMcHSARbm3bLpP78SFzDvMa03QymQA5daTfE/pDBiFPRAvo86ya63rcC3ZF7DQhX7X9moTUCU/vRb8k2V6kxFnOPu9LRV2JoOPkB1/wUo5mNTTYRNpzabrFvUMbU4J83WxwA+c0ko3fRNBz541CmY3jzqaV5nm8haenDr2YhvpcKlggnj1xMiDQkc6PDpxAwqThKEHpNrLwSf8mK96P+DEk=
  - secure: VUwixmgkhntNKfKOsk7zELrMYBEyUdaja8ybqgta8e44siXQtE1jWc18A1aH5L9GU+7JYbRCP7YW8iLQqbXZHQNHekT7aDRKeiq38djJ2KMxbyCCHfoAgCp75uKq5YKlpBWyrH7hNrmWyQA4PDJhAl5xcHQVLH89weSiZqTjRYgKLyag55qBHdwA1gfSnwmPwpBZeN1AMR1NLw3nJKdjgzE8wifPQwa9frZVZaJFj83eXm29rsYyQx217RMO6oIr9h1eYHl6xxNbL3JZAQEyMOgXNL/E/ipZrk89prU9kSCjPkrh0bTq0gOL0pQPT5Dd+IqF1n5eAkBbnLncvfZ7lJ/GT1ns6R7mcbA97ony4ciT7vO16TzNjpuC80zOIISnLEd/VXhGdqaEIs9h5gPJRMTfs+mT+iihjoHS3MxAQaOP/xVQlVIdWoRpctYNSfEtzdoqPn13PamZn6dUuRuR2z31GYVkM1CvzLqa1Vn8eNbM+QnyVoO8UUHtBzZw0ydEcIfKmdkITHdlF7QWOMfnGnhJSzsRqbqWNF7mVrjnj5L6P6Q6zuoH550O2o7AYTomxqvNbuoiKn56YuqKUG3fU+PeoMhAmbDNsikIo1VE7SyfOOJcTuvo9/DIsFKmrQCMdg1wlY8r9cjPpC025Pc/u12/fVnbAz+ctegGn8ux3MM=
  - secure: J1B3SMUDOmRjlIm+HDJHOEMaRl9YGHPHVgLLCV15IXbQsot/CidCz+/xnMXfx74Yfhn/SQNMf9a4CvE2vhul6JquT3+Kh09F0FIzq+sqDP+Zallvf0blcvPZGHAQO4B2xCM6lNq2OPPrcMzD46pR8kQvliwRK4Rllfh6trXbg2qwIgAlAIUPrf1CbirovUN3lQucWf+vVCSks02bN3LNnc3DKskVvbdsz3h4BBl991Ff+RnfIYF0EI1VKv0ijXhbldsRJOQsRi3lNCQp0nnvsadsSZSwGb0/kA/tWRHNtVHgjsTHAi6p+a+4ctk3hQuUaV/JRDJoztf6Y/YESVC92UdEG5kFrL3fX03LdM4kVxq8RLPPi5EkX7LLLbkRSLFi2Yt056QGO2SyJQ7xZv2PcgGPa77V8ay4Pf0MMtyjOxpSwLBCgbUOCOnHsyeOu0McApiyqnKLcmyovM/Ld804z1UV+ra49IFGvq05tIga0wYSB1QoJWsMGExYbGFTE1Eq8se+dLfgs9nS5YWc0jCQi5i0NGVH21xeyFc/fBcgSwYoev9B/baqVI6vOzWixjQwLnFV06C0qzbgw+oIG27Pd1oVfCBgtTeR+x1qf6kYiVoP80B0wYtERLTfOwftHCH9y7MMUg5tjFjYG7ovZSOjjFQ/wZrVCxn7TMmgiEg7cP0=
  - secure: r+eXVS0DVkLYDUqOSN1lhXa6laUWd4yMk2UfVveXmOwllu1HL7N9U7zBvishuLwxIVwWSWKbGUbaBsf1MTGJprBXY5Xbehoq1AJ7eHG2nREjMnbCkSJU2MFfgW5qBbcKhAgoGK6Fdy7GtqpBS+//kZiW0TxWBC3Nz5rQ9WfoNhIcAxAITnGUosGsGTd5Ag4gPvKMlG+Bh1fQvET1k5ODb0WDoldzPi7gF0ryvAkNfDqDWz/F+QAd9yCjS3lHfbzLW/vdsp8S1Iian3aWVxfsPpO/C9j4cEbYUl9w5YDBMqMRE3ei/+C24CbSzQqRfGwwiZNkP7jHirOl8R8M1qForiQ7qwLx5hN77xewfXtMSToKV0juUQZlkAhc8d4GDZXITyhiCEBWRoqVmJkOoTNsIwnYOHozWrz6fV4LfHTE6lfPj3POBm1Thruw8ycGvm93P3nu1yzau6oRHOrDutV+hhN4GHuF17Mh1bI2oTD7NUh/BjRZWptyDJcGXP9idiaP/LK8Z4iJQMIpnLbzvknIGngkCVIOF4y1rKOMzPlMUhhO5Ma3S9R0Z+p/9Aag+9bmN1alboElcwu/f6AyuKWmavAXcm6HzbIx8mrSEaGGJsRsOU5X4i0D1gJZwc3jubBuCIi1N7W3I+T077j2h6ZrmC6+jq4mOwm03kkwCGv2w3c=
  - secure: VIARZZ5EEc8B23BQNOcQWO9rNAFp9vAcrQhECo25ltuDQ4RM7ag9yV8DprqHK+bKWG3NX+xULrBMJ7M7Exm1eK1qetDLoFaD6PhjlM/TiH+csNkeKiZJV4StB/kkZ03A3h+bgauPispAP71aOhOz/nY/UfxXh/CJMMcr88H9rBLcRKwy6jK+XKG38iTLHIdKZio3X8VrFI6n5TN6+euJLhGqcE62GB+sJzJdWFhR+pJth2u+YdbtUZKcNtoWpc65RlZpfxKWT5ruC4a9oL/Uw5tCPOzCPrJMznUpsM8avSRQVZmWT11/vcC8Iupc63NLEH5Yuhs+OTOgt0rsD4Eog6t6Nf3w/VFY/kXaZkxDIHe2t/g1tDzWJjNr3zAToercIr574ljLHZgPLQxFo+e4lxaOyV8n4oLm3DVPgPsHlYTkBbTOERk5rB1MpT6hgwpDrGFmp6fe0Eo43vBI0a5/Xw9+K+f0DBxJsvE1hGM2TfNo0qFwGmMTELUnckuaOH6Y2eLNpEBEaE2779384qoQ77Xz4a428tKmZUGaVktMR1sFDFU5jS4ctGMLwNdC3YJE2eiG3SIZbe9pmd5JOZPGRbWotNKb4TODFVRFZ4OvJ316E1vfiSqTAD6L/d8hav//65GLDqFmH/UGS2oN/3W9A7W6GyM6FctoYZgCF2TO0U0=
before_script:
- npm install -g bower
script: mvn -Ppackage,docker package
after_success:
- docker login -u $DOCKER_USER -p $DOCKER_PASS
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH
  ; fi`
- export REPO=portlandwebworks/mdhs-poc
- docker tag $REPO $REPO:$TAG
- docker tag $REPO $REPO:travis-$TRAVIS_BUILD_NUMBER
- docker push $REPO
- curl https://sdk.cloud.google.com | bash
- source /home/travis/.bashrc
- source $HOME/google-cloud-sdk/path.bash.inc
- gcloud components update kubectl
- kubectl config set-credentials default --username=${GKE_USERNAME} --password=${GKE_PASSWORD}
- kubectl config set-cluster default --server=${GKE_SERVER} --insecure-skip-tls-verify=true
- kubectl config set-context default --cluster=default --user=default
- kubectl config use-context default
- kubectl patch deployment mdhs-deployment -p '{"spec":{"template":{"spec":{"containers":[{"name":"'"webapp"'","image":"'"portlandwebworks/mdhs-poc:travis-$TRAVIS_BUILD_NUMBER"'"}]}}}}'
notifications:
  slack:
    secure: QlVFdYZLvYMOiKqnX4Ul65GdSz1+A8pSlogY++41rpGVteiZD8HdzEsXZMNAOi9HutsCAA+zxZxtqgynlu2im0UT2IehFGQNSfaAVRuZwnBzwYUVSGFc2n2w7UZ3XaGjGP3FyarfH2CnnCnfDBQdmnxHzPG1j+6gJlHk0+Yrn4Nh6TTDBeMZg//B4OtYmJ2T5WNio1DabKj1BYCXAJpcloMVK/EGmuKAQxc9UAbkFphjm0ChWzvi2JuFK94Pl81zv6m9jbmiiUYcrkZxSx/OzJec4ETaQsOsqYJwKwqTev2orxpMDBF5zJJpEGulAOhTDTBVF7udYeWrOSzfbja/QbO+3GCPWmOyASb4fROAn3OQPy3szVnuj8NlhCHTRMDDKEKJIaePaSnqiah8G4k6mesmnFHQla/XdN745gg1HxC7qclyRBTI94mtg1UIv/YkM4PW3tD5GixT0WT6nuQrOpj8j0AvLqLc19exa57GNwSJwSaoMgWm3tvK6Rnypb06RSfk4QeAUpG++DJw22oyPdxSOsQjGfOnu/KqIuSInM6jPq//JaW7xCwWrFF4xZBkk8S+/3JWf0/pEwj1GZdkJb6Dor2ZexWlO/lY6XXaUdzoA+MJ7STLVYMtQFlxCfyGrIq56VhebtJqCsmhm3vB0Orggo1fvAn2tGr3M1Dmup0=
